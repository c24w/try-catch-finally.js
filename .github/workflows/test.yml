name: Test

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [0.12.x, 4.x, 6.x, 8.x, 10.x]
    name: Test in Node.js ${{matrix.node-version}}
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: ${{matrix.node-version}}
    - run: npm install
    - name: Test
      run: npm test
      if: '!startsWith(matrix.node-version, 10)'
    - name: Test with coverage
      run: |
        npm_config_coverage=y npm test
        cat ./coverage/lcov.info | ./node_modules/.bin/coveralls
      if: startsWith(matrix.node-version, 10)
      env:
        COVERALLS_SERVICE_NAME: GitHub Actions
        COVERALLS_REPO_TOKEN: ${{secrets.COVERALLS_TOKEN}}
